<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Abeer Reviews</title>

<style>
  body{
    font-family: Arial;
    background:#f5f5f5;
    padding:20px;
  }
  .box{
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
    max-width:600px;
    margin:auto;
  }
  input, textarea {
    width:100%;
    padding:10px;
    margin-top:10px;
    border:1px solid #ccc;
    border-radius:8px;
    font-size:16px;
  }
  button{
    margin-top:15px;
    padding:12px 20px;
    background:#00b8b8;
    border:none;
    border-radius:8px;
    color:white;
    font-size:17px;
    font-weight:700;
    cursor:pointer;
  }
  .review{
    background:white;
    padding:16px;
    border-radius:12px;
    margin-top:12px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
  }
  .delete-btn{
    color:red;
    cursor:pointer;
    font-size:14px;
    float:right;
  }
</style>
</head>

<body>

<div class="box">
  <h2>Leave a Review ‚≠ê</h2>

  <input id="name" placeholder="Your Name" />
  <textarea id="comment" rows="4" placeholder="Write your review..."></textarea>

  <button onclick="submitReview()">Submit Review</button>
</div>

<h2 style="text-align:center;margin-top:30px;">Customer Reviews</h2>
<div id="reviews"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA75fT3IbxJits64CnYXJeCu7fuCtaBRDQ",
    authDomain: "abeerreview.firebaseapp.com",
    projectId: "abeerreview",
    storageBucket: "abeerreview.firebasestorage.app",
    messagingSenderId: "522224848214",
    appId: "1:522224848214:web:eac23b8653099d70361af7",
    measurementId: "G-JFD5W7NR4V"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function submitReview(){
    let name = document.getElementById("name").value;
    let comment = document.getElementById("comment").value;

    if(!name || !comment){
      alert("Please fill all fields");
      return;
    }

    await addDoc(collection(db, "reviews"), {
      name:name,
      comment:comment,
      time: Date.now()
    });

    alert("Review submitted!");
    location.reload();
  }

  async function loadReviews(){
    let list = document.getElementById("reviews");
    const querySnapshot = await getDocs(collection(db, "reviews"));

    querySnapshot.forEach((docu) => {
      let data = docu.data();

      let div = document.createElement("div");
      div.className = "review";
      div.innerHTML = `
        <b>${data.name}</b>  
        <span class="delete-btn" onclick="deleteReview('${docu.id}')">Delete</span>
        <p>${data.comment}</p>
      `;
      list.appendChild(div);
    });
  }
  loadReviews();

  window.deleteReview = async function(id){
    await deleteDoc(doc(db, "reviews", id));
    alert("Review deleted");
    location.reload();
  }
</script>

</body>
</html>